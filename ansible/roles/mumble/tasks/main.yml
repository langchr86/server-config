---

- name: Create folders
  become: yes
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ mb_user }}"
    group: "{{ mb_group }}"
    mode: "775"
    recurse: yes
  with_items:
    - "{{ mb_app_folder }}"
    - "{{ mb_config_folder }}"
    - "{{ mb_data_folder }}"

- name: Create folder for docker compose file
  become: yes
  file:
    path: "{{ mb_compose_folder }}"
    state: directory

- name: "Evaluate {{ mb_cert_user }} UID"
  command: "id -u {{ mb_cert_user }}"
  changed_when: false
  register: uid

- name: "Evaluate {{ mb_cert_group }} GID"
  command: "id -g {{ mb_cert_group }}"
  changed_when: false
  register: gid

- name: Copy docker compose file
  become: yes
  template:
    src: "docker-compose.yml"
    dest: "{{ mb_compose_folder }}"

- name: "Enable and start docker compose service. Run 'docker exec -it mumble supw <new_password>' to change the super user password"
  become: yes
  systemd:
    name: "docker-compose@{{ mb_service_name }}"
    state: started
    enabled: yes
