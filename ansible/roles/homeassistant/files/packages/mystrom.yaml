# myStrom Switch Integrations

rest:
  - scan_interval: 30
    resource: http://192.168.0.85/report
    method: GET
    sensor:
      - name: Tumbler Leistung
        value_template: '{{ value_json.power }}'
        unit_of_measurement: 'W'
        device_class: power
        state_class: measurement
      - name: Tumbler Energie
        value_template: '{{ value_json.Ws }}'
        unit_of_measurement: 'W'
        state_class: measurement
        device_class: power
    binary_sensor:
      - name: Tumbler Status
        value_template: '{{ value_json.relay }}'
        device_class: power
  - scan_interval: 30
    resource: http://192.168.0.86/report
    method: GET
    sensor:
      - name: Waschmaschine Leistung
        value_template: '{{ value_json.power }}'
        unit_of_measurement: 'W'
        device_class: power
        state_class: measurement
      - name: Waschmaschine Energie
        value_template: '{{ value_json.Ws }}'
        unit_of_measurement: 'W'
        state_class: measurement
        device_class: power
    binary_sensor:
      - name: Waschmaschine Status
        value_template: '{{ value_json.relay }}'
        device_class: power
  - scan_interval: 30
    resource: http://192.168.0.87/report
    method: GET
    sensor:
      - name: Enthärtung Leistung
        value_template: '{{ value_json.power }}'
        unit_of_measurement: 'W'
        device_class: power
        state_class: measurement
      - name: Enthärtung Energie
        value_template: '{{ value_json.Ws }}'
        unit_of_measurement: 'W'
        state_class: measurement
        device_class: power
    binary_sensor:
      - name: Enthärtung Status
        value_template: '{{ value_json.relay }}'
        device_class: power
  - scan_interval: 30
    resource: http://192.168.0.88/report
    method: GET
    sensor:
      - name: Regenwasser Leistung
        value_template: '{{ value_json.power }}'
        unit_of_measurement: 'W'
        device_class: power
        state_class: measurement
      - name: Regenwasser Energie
        value_template: '{{ value_json.Ws }}'
        unit_of_measurement: 'W'
        state_class: measurement
        device_class: power
    binary_sensor:
      - name: Regenwasser Status
        value_template: '{{ value_json.relay }}'
        device_class: power
  - scan_interval: 30
    resource: http://192.168.0.89/report
    method: GET
    sensor:
      - name: Geschirrspüler Leistung
        value_template: '{{ value_json.power }}'
        unit_of_measurement: 'W'
        device_class: power
        state_class: measurement
      - name: Geschirrspüler Energie
        value_template: '{{ value_json.Ws }}'
        unit_of_measurement: 'W'
        state_class: measurement
        device_class: power
    binary_sensor:
      - name: Geschirrspüler Status
        value_template: '{{ value_json.relay }}'
        device_class: power

sensor:
  - name: Tumbler Energie Total
    platform: integration
    source: sensor.tumbler_energie
    method: left
  - name: Waschmaschine Energie Total
    platform: integration
    source: sensor.waschmaschine_energie
    method: left
  - name: Enthärtung Energie Total
    platform: integration
    source: sensor.enthartung_energie
    method: left
  - name: Regenwasser Energie Total
    platform: integration
    source: sensor.regenwasser_energie
    method: left
  - name: Geschirrspüler Energie Total
    platform: integration
    source: sensor.geschirrspuler_energie
    method: left

template:
  - binary_sensor:
      - name: Tumbler Aktiv
        state: "{{ states('sensor.tumbler_leistung') | float(default=0) > 20.0 }}"
        device_class: running
      - name: Waschmaschine Aktiv
        state: "{{ states('sensor.waschmaschine_leistung') | float(default=0) > 5.0 }}"
        device_class: running
      - name: Enthärtung Aktiv
        state: "{{ states('sensor.enthartung_leistung') | float(default=0) > 5.0 }}"
        device_class: running
      - name: Regenwasser Aktiv
        state: "{{ states('sensor.regenwasser_leistung') | float(default=0) > 5.0 }}"
        device_class: running
      - name: Geschirrspüler Aktiv
        state: "{{ states('sensor.geschirrspuler_leistung') | float(default=0) > 5.0 }}"
        device_class: running

switch:
  - name: Tumbler
    platform: mystrom
    host: 192.168.0.85
  - name: Waschmaschine
    platform: mystrom
    host: 192.168.0.86
  - name: Enthärtung
    platform: mystrom
    host: 192.168.0.87
  - name: Regenwasser
    platform: mystrom
    host: 192.168.0.88
  - name: Geschirrspüler
    platform: mystrom
    host: 192.168.0.89
