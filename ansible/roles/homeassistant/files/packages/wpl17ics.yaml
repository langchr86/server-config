# Stiebel Eltron WPL17ICS Integrations

modbus:
  # Modbus address has offset 1.
  # Slave is always 1.
  - name: WPL17ICS
    type: tcp
    host: 192.168.0.31
    port: 502
    sensors:
      - name: WPL17ICS Aussentemperatur
        slave: 1
        address: 506
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS HK-1 Ist-Temperatur
        slave: 1
        address: 507
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS HK-1 Soll-Temperatur
        slave: 1
        address: 509
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Vorlauf Ist-Temperatur
        slave: 1
        address: 512
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Rücklauf Ist-Temperatur
        slave: 1
        address: 515
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Puffer Ist-Temperatur
        slave: 1
        address: 517
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Puffer Soll-Temperatur
        slave: 1
        address: 518
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Volumenstrom
        slave: 1
        address: 520
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: 'l/min'
      - name: WPL17ICS Warmwasser Ist-Temperatur
        slave: 1
        address: 521
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Warmwasser Soll-Temperatur
        slave: 1
        address: 522
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Kühlen Ist-Temperatur
        slave: 1
        address: 523
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Kühlen Soll-Temperatur
        slave: 1
        address: 524
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS WP Rücklauf-Temperatur
        slave: 1
        address: 541
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS WP Vorlauf-Temperatur
        slave: 1
        address: 542
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS WP Volumenstrom
        slave: 1
        address: 547
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: 'l/min'
      - name: WPL17ICS Raum Ist-Temperatur
        slave: 1
        address: 583
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Raum Soll-Temperatur
        slave: 1
        address: 584
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Raum Feuchte
        slave: 1
        address: 585
        input_type: input
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '%'
        device_class: humidity
      - name: WPL17ICS HK-1 Komfort-Temperatur
        slave: 1
        address: 1501
        input_type: holding
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS HK-1 Eco-Temperatur
        slave: 1
        address: 1502
        input_type: holding
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS HK-1 Heizkurve
        slave: 1
        address: 1503
        input_type: holding
        data_type: int16
        scale: 0.01
        precision: 2
      - name: WPL17ICS Warmwasser Komfort-Temperatur
        slave: 1
        address: 1509
        input_type: holding
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Warmwasser Eco-Temperatur
        slave: 1
        address: 1510
        input_type: holding
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Kühlen Regel-Temperatur
        slave: 1
        address: 1515
        input_type: holding
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: '°C'
        device_class: temperature
      - name: WPL17ICS Betriebsstatus
        slave: 1
        address: 2500
        input_type: input
        data_type: uint16
      - name: WPL17ICS Wärmemenge Heizen Tag
        slave: 1
        address: 3500
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Wärmemenge Heizen Summe kWh
        slave: 1
        address: 3501
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Wärmemenge Heizen Summe MWh
        slave: 1
        address: 3502
        input_type: input
        data_type: uint16
        unit_of_measurement: 'MWh'
        device_class: energy
      - name: WPL17ICS Wärmemenge Warmwasser Tag
        slave: 1
        address: 3503
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Wärmemenge Warmwasser Summe kWh
        slave: 1
        address: 3504
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Wärmemenge Warmwasser Summe MWh
        slave: 1
        address: 3505
        input_type: input
        data_type: uint16
        unit_of_measurement: 'MWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Heizen Tag
        slave: 1
        address: 3510
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Heizen Summe kWh
        slave: 1
        address: 3511
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Heizen Summe MWh
        slave: 1
        address: 3512
        input_type: input
        data_type: uint16
        unit_of_measurement: 'MWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Warmwasser Tag
        slave: 1
        address: 3513
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Warmwasser Summe kWh
        slave: 1
        address: 3514
        input_type: input
        data_type: uint16
        unit_of_measurement: 'kWh'
        device_class: energy
      - name: WPL17ICS Leistungsaufnahme Warmwasser Summe MWh
        slave: 1
        address: 3515
        input_type: input
        data_type: uint16
        unit_of_measurement: 'MWh'
        device_class: energy
      - name: WPL17ICS Laufzeit Kühlen
        slave: 1
        address: 3544
        input_type: input
        data_type: uint16
        unit_of_measurement: 'h'
        device_class: duration
      - name: WPL17ICS Laufzeit Heizen
        slave: 1
        address: 3643
        input_type: input
        data_type: uint16
        unit_of_measurement: 'h'
        device_class: duration
      - name: WPL17ICS Laufzeit Warmwasser
        slave: 1
        address: 3644
        input_type: input
        data_type: uint16
        unit_of_measurement: 'h'
        device_class: duration
      - name: WPL17ICS SG-Ready Betriebszustand
        slave: 1
        address: 5000
        input_type: input
        data_type: uint16

template:
  - sensor:
      - name: WPL17ICS Wärmemenge Heizen Summe
        unit_of_measurement: 'kWh'
        device_class: energy
        state_class: total_increasing
        state: "{{ states('sensor.wpl17ics_warmemenge_heizen_summe_kwh') | float(default=0) + states('sensor.wpl17ics_warmemenge_heizen_summe_mwh') | float(default=0) * 1000.0 }}"
      - name: WPL17ICS Wärmemenge Warmwasser Summe
        unit_of_measurement: 'kWh'
        device_class: energy
        state_class: total_increasing
        state: "{{ states('sensor.wpl17ics_warmemenge_warmwasser_summe_kwh') | float(default=0) + states('sensor.wpl17ics_warmemenge_warmwasser_summe_mwh') | float(default=0) * 1000.0 }}"
      - name: WPL17ICS Leistungsaufnahme Heizen Summe
        unit_of_measurement: 'kWh'
        device_class: energy
        state_class: total_increasing
        state: "{{ states('sensor.wpl17ics_leistungsaufnahme_heizen_summe_kwh') | float(default=0) + states('sensor.wpl17ics_leistungsaufnahme_heizen_summe_mwh') | float(default=0) * 1000.0 }}"
      - name: WPL17ICS Leistungsaufnahme Warmwasser Summe
        unit_of_measurement: 'kWh'
        device_class: energy
        state_class: total_increasing
        state: "{{ states('sensor.wpl17ics_leistungsaufnahme_warmwasser_summe_kwh') | float(default=0) + states('sensor.wpl17ics_leistungsaufnahme_warmwasser_summe_mwh') | float(default=0) * 1000.0 }}"
  - binary_sensor:
      - name: WPL17ICS Betriebsstatus aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(16383) > 0 }}"
        device_class: running
      - name: WPL17ICS Betriebsstatus HK-1 Pumpe aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(1) > 0 }}"
        device_class: running
      - name: WPL17ICS Betriebsstatus HK-2 Pumpe aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(2) > 0 }}"
        device_class: running
      - name: WPL17ICS Betriebsstatus Aufheizprogramm aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(4) > 0 }}"
        device_class: heat
      - name: WPL17ICS Betriebsstatus Elektrische Heizung aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(8) > 0 }}"
        device_class: heat
      - name: WPL17ICS Betriebsstatus Heizung aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(16) > 0 }}"
        device_class: heat
      - name: WPL17ICS Betriebsstatus Warmwasser aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(32) > 0 }}"
        device_class: heat
      - name: WPL17ICS Betriebsstatus Verdichter aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(64) > 0 }}"
        device_class: running
      - name: WPL17ICS Betriebsstatus Sommerbetrieb aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(128) > 0 }}"
        device_class: light
      - name: WPL17ICS Betriebsstatus Kühlbetrieb aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(256) > 0 }}"
        device_class: cold
      - name: WPL17ICS Betriebsstatus Abtauen aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(512) > 0 }}"
        device_class: heat
      - name: WPL17ICS Betriebsstatus Silentmode1 aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(1024) > 0 }}"
        device_class: sound
      - name: WPL17ICS Betriebsstatus Silentmode2 aktiv
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(2048) > 0 }}"
        device_class: sound
      - name: WPL17ICS Betriebsstatus EVU Sperre
        state: "{{ states('sensor.wpl17ics_betriebsstatus') | int(default=0) | bitwise_and(16384) > 0 }}"
        device_class: safety
